<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
	<script type="text/javascript" src="jquery-1.8.2.js" charset="utf-8"></script>
	<script type="text/javascript" src="hpci-cciframe-1.0.js" charset="utf-8"></script>
	<style>
		html,body {
		width: 100%;
		height: 100%;
		margin: 0 0;
		ping: 0;
		}

		@font-face {
		font-family: helvetica neue ultra light;
		src: url('font/ufonts.com_helvetica_neue_ultralight.ttf');
		}

		@font-face {
		font-family: helvetica neue thin;
		src: url('font/ufonts.com_helveticaneue_thin_1_.ttf');
		}

		@font-face {
		font-family: helvetica neue light thin;
		src: url('font/HelveticaNeue_Lt.ttf');
		}

		@font-face {
		font-family: noteworthy;
		src: url('font/Noteworthy.ttc');
		}

		.mdliveframe{
		position: absolute;
		overflow: hidden;
		}

		.mdlive-default-font-family {
		font-family: helvetica Neue;
		}
		.billing-page{
		width: 100%;
		float: left;

		}
		.billing-page-name{
		width: 94%;
		padding: 10px;
		float: left;
		background-color: #ECF5FA;
		font-weight: bold;
		}
		.add-billing-card-number-content,.add-billing-cc-security-code-content{
		float: left;
		padding: 10px 0px 10px 10px;
		width: 97%;
		}
		.add-billing-card-number,.add-billing-cc-security-code{
		float: left;
		font-size: 16px;
		width: 118px;
		}
		.add-billing-card-number-text,.add-billing-cc-security-code-text{
		float:left;
		width: 49%;
		}
		.add-billing-required-fields{
		border: 1px solid rgb(220, 220, 220);
		border-radius: 5px;
		display: block;
		font-family: helvetica Neue;
		font-size: 16px !important;
		font-weight: lighter;
		height: 26px;
		line-height: 20px;
		margin: 0 !important;
		padding: 0 0 0 5px !important;
		width: 100% !important;
		}
		.camera-icon{
		width:20px;
		float:left;
		margin: 0 0px 0 15px;
		}
		.billing-save-button{
		text-align: center;
		line-height: 52px;
		background: rgb(88, 119, 173);
		cursor: pointer;
		font-size: 22px !important;
		margin: 25px auto 0 auto;
		font-family: helvetica neue;
		border-radius: 5px;
		color: white;
		display: inline-block;
		width: 90%;
		}

	</style>
	<script type="text/javascript">

       	var parent_host_url = encodeURIComponent("file:///android_asset/htdocs");
		var hpciCCFrameHost = "https://cc.hostedpci.com";
		var parent_host_query_string = encodeURIComponent("/index.html");
		var hpciCCFrameFullUrl = null;
		var hpciCCFrameName = "mdliveframe";
		var billingData = null;


		var getCCTypeId = function(mappedCCValue) {
			// 1    Visa
			// 2    MasterCard
			// 3    Discover
			// 5    AMEX
			// Using basic regex validation
			var re = new RegExp("^4");
			if (mappedCCValue.match(re) != null)
				return 1; //VISA

			re = new RegExp("^5[1-5]");
			if (mappedCCValue.match(re) != null)
				return 2; //MasterCard

			re = new RegExp("^6011");
			if (mappedCCValue.match(re) != null)
				return 3; //Discover

			re = new RegExp("^(34|37)");
			if (mappedCCValue.match(re) != null)
				return 5; //Amex
			return 0;
		};

		var mergeDataBillingWithToken = function(mappedCCValue, mappedCVVValue,
				ccBINValue) {
				this.billingData = {
					"billing_information" : {
						"cc_num": 0,
						"cc_cvv2" : 0,
						"cc_hsa" : true,
						"cc_type_id" : 0
					}
				}
		    this.billingData.billing_information.cc_num = mappedCCValue;
			this.billingData.billing_information.cc_cvv2 = mappedCVVValue;
			this.billingData.billing_information.cc_type_id = this.getCCTypeId(mappedCCValue);
			window.billing.sendToAndroid(JSON.stringify(this.billingData));
		};

		var errorResponse = function() {
			 alert("Inavlid credit card information.");
		};

		var cameraIcon = function(){
			alert("Camera icon Clicked.");
		};

		var tokenizeForm = function () {

			setTimeout(
					function() {
						jQuery('input').blur();
						var oError = new Error();
						this.billingData = null;
						//Set hostedPCI URL. This will be use to refresh the HPCI iframe when user failed to input correct cc number or cvv
						this.hpciCCFrameFullUrl = "https://cc.hostedpci.com/iSynSApp/showPxyPage!ccFrame.action?pgmode1=stag&locationName=mobile&sid=527122&fullParentHost="
								+ this.parent_host_url
								+ "&fullParentQStr="
								+ this.parent_host_query_string;
						console.log("hpciCCFrameFullUrl :" + this.hpciCCFrameFullUrl);

						// 1. Tokenize the cc number after all required fields are fulfilled
						if(jQuery.trim(jQuery('.card-number-input').val())=="" || jQuery.trim(jQuery('.security-code-input').val())==""){
							alert("Please fill all the fields");
						}else if (jQuery('#ccCVV').val().length < 3 || jQuery('#ccCVV').val().match(/[^0-9\/]/g)) {
						    alert("Inavlid credit card information.");
						}
						else {
						        console.log("Tokenizing...");
						        return sendHPCIMsg();
						}
					}, 50);

		};

</script>
</head>
<body>
<div class="billing-page">
	<div class="billing-page-name">Credit Card</div>
	<div class="add-billing-card-number-content" >
		<div class="add-billing-card-number mdlive-default-font-family">
			Card Number
		</div>
		<div class="add-billing-card-number-text">
			<input class="add-billing-required-fields card-number-input" id="ccNum" type="text" name="ccNum" src="font/HelveticaNeue_Lt.ttf"  value="" />
		</div>
		<div class="camera-icon" onclick="cameraIcon(); return false;"><img src="images/photo.png" width="38" height="22"></div>
	</div>

	<div class="add-billing-cc-security-code-content" style="">
		<div class="add-billing-cc-security-code mdlive-default-font-family">
			Security Code
		</div>
		<div class="add-billing-cc-security-code-text">
			<input type="text" class="security-code-input add-billing-required-fields" id="ccCVV" maxlength="4" name="ccCVV"  src="font/HelveticaNeue_Lt.ttf" />
		</div>
	</div>

	<input type="hidden" id="ccNum" name="mdliveCCNum" value="" /> <input type="hidden" id="ccCVV" name="mdliveCCCVV" value="" />
	<div class="billing-save-button mdlive-default-font-family " onclick="tokenizeForm(); return false;">Save</div>
</div>
</body>
</html>